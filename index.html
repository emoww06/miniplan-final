<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MiniPlan Premium</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- PWA Meta Tags -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2196F3">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="MiniPlan">
    
    <!-- Security Meta Tags -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: https:; font-src 'self' https: data:;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
</head>
<body>
    <!-- User Setup Modal -->
    <div id="userSetupModal" class="modal">
        <div class="modal-content">
            <h2>MiniPlan'a Ho≈ü Geldiniz!</h2>
            <p>Kullanmaya ba≈ülamak i√ßin bir kullanƒ±cƒ± adƒ± olu≈üturun:</p>
            <input type="text" id="usernameInput" placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin" maxlength="20">
            <button onclick="createUser()" class="btn">Ba≈üla</button>
        </div>
    </div>

    <!-- Friend Modal -->
    <div id="friendModal" class="modal">
        <div class="modal-content">
            <h2>Arkada≈ü Y√∂netimi</h2>
            <div class="friend-section">
                <h3>Arkada≈ü Ekle</h3>
                <input type="text" id="friendCodeInput" placeholder="Arkada≈ü kodunu girin">
                <button onclick="addFriend()" class="btn">Ekle</button>
            </div>
            <div class="friend-section">
                <h3>Arkada≈ülarƒ±m</h3>
                <div id="friendsList"></div>
            </div>
            <div class="friend-section">
                <h3>Benim Kodum</h3>
                <div class="user-code">
                    <span id="userCodeDisplay"></span>
                    <button onclick="copyUserCode()" class="btn-secondary">Kopyala</button>
                </div>
            </div>
            <button onclick="closeFriendModal()" class="btn-secondary">Kapat</button>
        </div>
    </div>

    <!-- Premium Plan Modal -->
    <div id="premiumModal" class="modal">
        <div class="modal-content">
            <h2>Premium Plan</h2>
            <div class="premium-options">
                <div class="premium-option">
                    <h3>√úcretsiz Plan</h3>
                    <ul>
                        <li>G√ºnl√ºk 3 hedef</li>
                        <li>Temel √∂zellikler</li>
                        <li>Reklamsƒ±z</li>
                    </ul>
                    <button onclick="selectPlan('free')" class="btn">Se√ß</button>
                </div>
                <div class="premium-option premium">
                    <h3>Premium Plan</h3>
                    <ul>
                        <li>Sƒ±nƒ±rsƒ±z hedef</li>
                        <li>Geli≈ümi≈ü analitik</li>
                        <li>√ñzel temalar</li>
                        <li>√ñncelikli destek</li>
                    </ul>
                    <button onclick="selectPlan('premium')" class="btn">Se√ß</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <header class="header">
            <div class="logo">üìã</div>
            <h1 class="title">MiniPlan Premium</h1>
            <p class="subtitle">G√ºnl√ºk hedeflerinizi planlayƒ±n ve takip edin</p>
            <div class="ai-motivation" id="aiMotivation">
                "Bug√ºn harika bir g√ºn! Hedeflerinize odaklanƒ±n ve ba≈üarƒ±ya ula≈üƒ±n!"
            </div>
            <div class="header-controls">
                <button onclick="showPremiumModal()" class="btn-header">Premium</button>
                <button onclick="showFriendModal()" class="btn-header">Arkada≈ülar</button>
            </div>
        </header>

        <main class="main-content">
            <div class="left-column">
                <!-- Calendar Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-calendar"></i>
                        Takvim
                    </h2>
                    <div class="calendar">
                        <div class="calendar-header">
                            <button class="calendar-nav" onclick="previousMonth()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <h3 class="calendar-title" id="calendarTitle">Ocak 2024</h3>
                            <button class="calendar-nav" onclick="nextMonth()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div class="calendar-grid" id="calendarGrid"></div>
                    </div>
                </section>

                <!-- Goals Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-target"></i>
                        Hedefler
                    </h2>
                    <div class="goals-section">
                        <h3 class="selected-date" id="selectedDate">Bug√ºn</h3>
                        <div class="goal-inputs" id="goalInputs">
                            <input type="text" class="goal-input" placeholder="Hedef 1" data-index="0">
                            <input type="text" class="goal-input" placeholder="Hedef 2" data-index="1">
                            <input type="text" class="goal-input" placeholder="Hedef 3" data-index="2">
                        </div>
                        <button onclick="addGoalInput()" class="btn-secondary">+ Hedef Ekle</button>
                        <div class="goals-list" id="goalsList"></div>
                    </div>
                </section>

                <!-- Progress Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-chart-line"></i>
                        ƒ∞lerleme
                    </h2>
                    <div class="progress-section">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-number" id="completedGoals">0</div>
                                <div class="stat-label">Tamamlanan</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="totalGoals">0</div>
                                <div class="stat-label">Toplam</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-number" id="streak">0</div>
                                <div class="stat-label">Seri</div>
                            </div>
                        </div>
                    </div>
                </section>
            </div>

            <div class="right-column">
                <!-- Personal Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-user"></i>
                        Ki≈üisel
                    </h2>
                    <div class="tabs">
                        <div class="tab active" onclick="switchTab('notes')">Notlar</div>
                        <div class="tab" onclick="switchTab('mood')">Ruh Hali</div>
                        <div class="tab" onclick="switchTab('details')">Detaylar</div>
                    </div>
                    
                    <div class="tab-content active" id="notesTab">
                        <textarea id="dailyNotes" placeholder="Bug√ºnk√º notlarƒ±nƒ±zƒ± buraya yazƒ±n..." rows="4"></textarea>
                        <button onclick="saveNotes()" class="btn">Kaydet</button>
                    </div>
                    
                    <div class="tab-content" id="moodTab">
                        <div class="mood-selector">
                            <div class="mood-option" onclick="selectMood('üòä')">üòä</div>
                            <div class="mood-option" onclick="selectMood('üòê')">üòê</div>
                            <div class="mood-option" onclick="selectMood('üòî')">üòî</div>
                            <div class="mood-option" onclick="selectMood('üò§')">üò§</div>
                            <div class="mood-option" onclick="selectMood('üéâ')">üéâ</div>
                        </div>
                        <div class="mood-history" id="moodHistory"></div>
                    </div>
                    
                    <div class="tab-content" id="detailsTab">
                        <div class="detail-item">
                            <label>Uyku Saati:</label>
                            <input type="time" id="sleepTime">
                        </div>
                        <div class="detail-item">
                            <label>Su ƒ∞√ßme (Litre):</label>
                            <input type="number" id="waterIntake" min="0" max="10" step="0.1">
                        </div>
                        <div class="detail-item">
                            <label>Egzersiz (Dakika):</label>
                            <input type="number" id="exerciseTime" min="0" max="300">
                        </div>
                        <button onclick="saveDetails()" class="btn">Kaydet</button>
                    </div>
                </section>

                <!-- Analytics Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-analytics"></i>
                        Analitik
                    </h2>
                    <div class="analytics-content">
                        <div class="chart-container">
                            <h3>Haftalƒ±k Rapor</h3>
                            <div class="weekly-chart" id="weeklyChart"></div>
                        </div>
                        <div class="chart-container">
                            <h3>Kategori Daƒüƒ±lƒ±mƒ±</h3>
                            <div class="category-chart" id="categoryChart"></div>
                        </div>
                    </div>
                </section>

                <!-- Reminders Section -->
                <section class="section">
                    <h2 class="section-title">
                        <i class="section-icon fas fa-bell"></i>
                        Hatƒ±rlatƒ±cƒ±lar
                    </h2>
                    <div class="reminders-content">
                        <div class="reminder-item">
                            <input type="time" id="morningReminder" value="09:00">
                            <label>Sabah Hatƒ±rlatƒ±cƒ±sƒ±</label>
                        </div>
                        <div class="reminder-item">
                            <input type="time" id="eveningReminder" value="21:00">
                            <label>Ak≈üam Hatƒ±rlatƒ±cƒ±sƒ±</label>
                        </div>
                        <button onclick="saveReminders()" class="btn">Kaydet</button>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <script>
        // Global variables
        let currentUser = null;
        let currentDate = new Date();
        let selectedDate = new Date();
        let goals = {};
        let userStats = {};
        let dailyNotes = {};
        let moodData = {};
        let dailyDetails = {};
        let userPlan = 'free';
        let premiumExpiry = null;
        let friends = [];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            loadUserData();
            checkUserSetup();
            updateCalendar();
            updateGoals();
            updateProgress();
            updateAnalytics();
            updateMoodHistory();
            loadReminders();
        });

        // User management
        function checkUserSetup() {
            if (!currentUser) {
                document.getElementById('userSetupModal').style.display = 'flex';
            }
        }

        function createUser() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username.length < 2) {
                alert('Kullanƒ±cƒ± adƒ± en az 2 karakter olmalƒ±dƒ±r!');
                return;
            }
            
            currentUser = {
                id: generateUserId(),
                username: username,
                createdAt: new Date().toISOString()
            };
            
            saveUserData();
            document.getElementById('userSetupModal').style.display = 'none';
            updateUserCode();
        }

        function generateUserId() {
            return 'user_' + Math.random().toString(36).substr(2, 9);
        }

        function updateUserCode() {
            if (currentUser) {
                document.getElementById('userCodeDisplay').textContent = currentUser.id;
            }
        }

        // Data persistence
        function saveUserData() {
            localStorage.setItem('miniplan_user', JSON.stringify(currentUser));
            localStorage.setItem('miniplan_goals', JSON.stringify(goals));
            localStorage.setItem('miniplan_stats', JSON.stringify(userStats));
            localStorage.setItem('miniplan_notes', JSON.stringify(dailyNotes));
            localStorage.setItem('miniplan_mood', JSON.stringify(moodData));
            localStorage.setItem('miniplan_details', JSON.stringify(dailyDetails));
            localStorage.setItem('miniplan_plan', userPlan);
            localStorage.setItem('miniplan_premium_expiry', premiumExpiry);
            localStorage.setItem('miniplan_friends', JSON.stringify(friends));
        }

        function loadUserData() {
            try {
                currentUser = JSON.parse(localStorage.getItem('miniplan_user')) || null;
                goals = JSON.parse(localStorage.getItem('miniplan_goals')) || {};
                userStats = JSON.parse(localStorage.getItem('miniplan_stats')) || {};
                dailyNotes = JSON.parse(localStorage.getItem('miniplan_notes')) || {};
                moodData = JSON.parse(localStorage.getItem('miniplan_mood')) || {};
                dailyDetails = JSON.parse(localStorage.getItem('miniplan_details')) || {};
                userPlan = localStorage.getItem('miniplan_plan') || 'free';
                premiumExpiry = localStorage.getItem('miniplan_premium_expiry');
                friends = JSON.parse(localStorage.getItem('miniplan_friends')) || [];
                
                updateUserCode();
            } catch (error) {
                console.error('Veri y√ºkleme hatasƒ±:', error);
            }
        }

        // Calendar functions
        function updateCalendar() {
            const monthNames = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                               'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            
            document.getElementById('calendarTitle').textContent = 
                monthNames[currentDate.getMonth()] + ' ' + currentDate.getFullYear();
            
            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';
            
            // Add weekday headers
            const weekdays = ['Pzt', 'Sal', '√áar', 'Per', 'Cum', 'Cmt', 'Paz'];
            weekdays.forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.className = 'weekday-header';
                dayHeader.textContent = day;
                grid.appendChild(dayHeader);
            });
            
            const firstDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const lastDay = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay() + 1);
            
            for (let i = 0; i < 42; i++) {
                const date = new Date(startDate);
                date.setDate(startDate.getDate() + i);
                
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = date.getDate();
                
                if (date.getMonth() !== currentDate.getMonth()) {
                    dayElement.classList.add('other-month');
                }
                
                if (isSameDay(date, new Date())) {
                    dayElement.classList.add('today');
                }
                
                if (isSameDay(date, selectedDate)) {
                    dayElement.classList.add('selected');
                }
                
                const dateKey = formatDate(date);
                if (goals[dateKey] && goals[dateKey].length > 0) {
                    dayElement.classList.add('has-goals');
                }
                
                dayElement.onclick = () => selectDate(date);
                grid.appendChild(dayElement);
            }
        }

        function selectDate(date) {
            selectedDate = date;
            updateCalendar();
            updateGoals();
            updateSelectedDateDisplay();
            loadDayData();
        }

        function updateSelectedDateDisplay() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            if (isSameDay(selectedDate, today)) {
                document.getElementById('selectedDate').textContent = 'Bug√ºn';
            } else if (isSameDay(selectedDate, tomorrow)) {
                document.getElementById('selectedDate').textContent = 'Yarƒ±n';
            } else {
                document.getElementById('selectedDate').textContent = formatDate(selectedDate);
            }
        }

        function previousMonth() {
            currentDate.setMonth(currentDate.getMonth() - 1);
            updateCalendar();
        }

        function nextMonth() {
            currentDate.setMonth(currentDate.getMonth() + 1);
            updateCalendar();
        }

        // Goal management
        function updateGoals() {
            const dateKey = formatDate(selectedDate);
            const dayGoals = goals[dateKey] || [];
            
            // Update goal inputs
            const inputs = document.querySelectorAll('.goal-input');
            inputs.forEach((input, index) => {
                input.value = dayGoals[index] || '';
            });
            
            // Update goals list
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            dayGoals.forEach((goal, index) => {
                if (goal) {
                    const goalItem = document.createElement('div');
                    goalItem.className = 'goal-item';
                    goalItem.innerHTML = `
                        <input type="checkbox" class="goal-checkbox" onchange="toggleGoal(${index})" ${goal.completed ? 'checked' : ''}>
                        <span class="goal-text ${goal.completed ? 'completed' : ''}">${goal.text}</span>
                        <button onclick="deleteGoal(${index})" class="btn-secondary">Sil</button>
                    `;
                    goalsList.appendChild(goalItem);
                }
            });
            
            updateProgress();
        }

        function addGoalInput() {
            if (userPlan === 'free' && document.querySelectorAll('.goal-input').length >= 3) {
                alert('√úcretsiz planda maksimum 3 hedef ekleyebilirsiniz. Premium plana ge√ßin!');
                return;
            }
            
            const goalInputs = document.getElementById('goalInputs');
            const newIndex = document.querySelectorAll('.goal-input').length;
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'goal-input';
            input.placeholder = `Hedef ${newIndex + 1}`;
            input.dataset.index = newIndex;
            input.addEventListener('input', saveGoals);
            goalInputs.appendChild(input);
        }

        function saveGoals() {
            const dateKey = formatDate(selectedDate);
            const inputs = document.querySelectorAll('.goal-input');
            const dayGoals = [];
            
            inputs.forEach(input => {
                const text = input.value.trim();
                if (text) {
                    dayGoals.push({
                        text: text,
                        completed: false,
                        createdAt: new Date().toISOString()
                    });
                }
            });
            
            goals[dateKey] = dayGoals;
            saveUserData();
            updateGoals();
        }

        function toggleGoal(index) {
            const dateKey = formatDate(selectedDate);
            if (goals[dateKey] && goals[dateKey][index]) {
                goals[dateKey][index].completed = !goals[dateKey][index].completed;
                saveUserData();
                updateGoals();
            }
        }

        function deleteGoal(index) {
            const dateKey = formatDate(selectedDate);
            if (goals[dateKey] && goals[dateKey][index]) {
                goals[dateKey].splice(index, 1);
                saveUserData();
                updateGoals();
            }
        }

        // Progress tracking
        function updateProgress() {
            const dateKey = formatDate(selectedDate);
            const dayGoals = goals[dateKey] || [];
            const completed = dayGoals.filter(goal => goal.completed).length;
            const total = dayGoals.length;
            
            document.getElementById('completedGoals').textContent = completed;
            document.getElementById('totalGoals').textContent = total;
            
            const progressFill = document.getElementById('progressFill');
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            progressFill.style.width = percentage + '%';
            
            // Update streak
            updateStreak();
        }

        function updateStreak() {
            let streak = 0;
            const today = new Date();
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateKey = formatDate(date);
                const dayGoals = goals[dateKey] || [];
                
                if (dayGoals.length > 0 && dayGoals.some(goal => goal.completed)) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('streak').textContent = streak;
        }

        // Personal features
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            document.querySelector(`[onclick="switchTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function saveNotes() {
            const notes = document.getElementById('dailyNotes').value;
            const dateKey = formatDate(selectedDate);
            dailyNotes[dateKey] = notes;
            saveUserData();
            showNotification('Notlar kaydedildi!');
        }

        function selectMood(mood) {
            const dateKey = formatDate(selectedDate);
            moodData[dateKey] = {
                mood: mood,
                timestamp: new Date().toISOString()
            };
            saveUserData();
            updateMoodHistory();
            showNotification('Ruh hali kaydedildi!');
        }

        function updateMoodHistory() {
            const history = document.getElementById('moodHistory');
            history.innerHTML = '';
            
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date);
            }
            
            last7Days.forEach(date => {
                const dateKey = formatDate(date);
                const mood = moodData[dateKey];
                const moodElement = document.createElement('div');
                moodElement.className = 'mood-day';
                moodElement.innerHTML = `
                    <span class="mood-date">${formatDate(date)}</span>
                    <span class="mood-emoji">${mood ? mood.mood : 'üòê'}</span>
                `;
                history.appendChild(moodElement);
            });
        }

        function saveDetails() {
            const dateKey = formatDate(selectedDate);
            dailyDetails[dateKey] = {
                sleepTime: document.getElementById('sleepTime').value,
                waterIntake: document.getElementById('waterIntake').value,
                exerciseTime: document.getElementById('exerciseTime').value
            };
            saveUserData();
            showNotification('Detaylar kaydedildi!');
        }

        function loadDayData() {
            const dateKey = formatDate(selectedDate);
            
            // Load notes
            document.getElementById('dailyNotes').value = dailyNotes[dateKey] || '';
            
            // Load details
            const details = dailyDetails[dateKey] || {};
            document.getElementById('sleepTime').value = details.sleepTime || '';
            document.getElementById('waterIntake').value = details.waterIntake || '';
            document.getElementById('exerciseTime').value = details.exerciseTime || '';
        }

        // Premium features
        function showPremiumModal() {
            document.getElementById('premiumModal').style.display = 'flex';
        }

        function selectPlan(plan) {
            userPlan = plan;
            if (plan === 'premium') {
                premiumExpiry = new Date();
                premiumExpiry.setFullYear(premiumExpiry.getFullYear() + 1);
            }
            saveUserData();
            document.getElementById('premiumModal').style.display = 'none';
            showNotification('Plan g√ºncellendi!');
        }

        // Social features
        function showFriendModal() {
            document.getElementById('friendModal').style.display = 'flex';
            updateFriendsList();
        }

        function closeFriendModal() {
            document.getElementById('friendModal').style.display = 'none';
        }

        function addFriend() {
            const friendCode = document.getElementById('friendCodeInput').value.trim();
            if (!friendCode) {
                alert('Arkada≈ü kodunu girin!');
                return;
            }
            
            if (friends.includes(friendCode)) {
                alert('Bu arkada≈ü zaten ekli!');
                return;
            }
            
            friends.push(friendCode);
            saveUserData();
            updateFriendsList();
            document.getElementById('friendCodeInput').value = '';
            showNotification('Arkada≈ü eklendi!');
        }

        function removeFriend(friendCode) {
            const index = friends.indexOf(friendCode);
            if (index > -1) {
                friends.splice(index, 1);
                saveUserData();
                updateFriendsList();
                showNotification('Arkada≈ü kaldƒ±rƒ±ldƒ±!');
            }
        }

        function updateFriendsList() {
            const friendsList = document.getElementById('friendsList');
            friendsList.innerHTML = '';
            
            friends.forEach(friendCode => {
                const friendItem = document.createElement('div');
                friendItem.className = 'friend-item';
                friendItem.innerHTML = `
                    <span>${friendCode}</span>
                    <button onclick="removeFriend('${friendCode}')" class="btn-secondary">Kaldƒ±r</button>
                `;
                friendsList.appendChild(friendItem);
            });
        }

        function copyUserCode() {
            if (currentUser) {
                navigator.clipboard.writeText(currentUser.id).then(() => {
                    showNotification('Kod kopyalandƒ±!');
                });
            }
        }

        // Analytics
        function updateAnalytics() {
            updateWeeklyChart();
            updateCategoryChart();
        }

        function updateWeeklyChart() {
            const chart = document.getElementById('weeklyChart');
            chart.innerHTML = '';
            
            const last7Days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date);
            }
            
            last7Days.forEach(date => {
                const dateKey = formatDate(date);
                const dayGoals = goals[dateKey] || [];
                const completed = dayGoals.filter(goal => goal.completed).length;
                const total = dayGoals.length;
                const percentage = total > 0 ? (completed / total) * 100 : 0;
                
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.height = percentage + '%';
                bar.title = `${formatDate(date)}: ${completed}/${total}`;
                chart.appendChild(bar);
            });
        }

        function updateCategoryChart() {
            const chart = document.getElementById('categoryChart');
            chart.innerHTML = '';
            
            // Simple category analysis (you can enhance this)
            const categories = {
                'Ki≈üisel': 0,
                'ƒ∞≈ü': 0,
                'Saƒülƒ±k': 0,
                'Eƒüitim': 0
            };
            
            Object.values(goals).flat().forEach(goal => {
                if (goal.text.toLowerCase().includes('spor') || goal.text.toLowerCase().includes('egzersiz')) {
                    categories['Saƒülƒ±k']++;
                } else if (goal.text.toLowerCase().includes('√ßalƒ±≈ü') || goal.text.toLowerCase().includes('i≈ü')) {
                    categories['ƒ∞≈ü']++;
                } else if (goal.text.toLowerCase().includes('okuy') || goal.text.toLowerCase().includes('√∂ƒüren')) {
                    categories['Eƒüitim']++;
                } else {
                    categories['Ki≈üisel']++;
                }
            });
            
            Object.entries(categories).forEach(([category, count]) => {
                const item = document.createElement('div');
                item.className = 'category-item';
                item.innerHTML = `
                    <span>${category}</span>
                    <span>${count}</span>
                `;
                chart.appendChild(item);
            });
        }

        // Reminders
        function loadReminders() {
            const morning = localStorage.getItem('miniplan_morning_reminder') || '09:00';
            const evening = localStorage.getItem('miniplan_evening_reminder') || '21:00';
            
            document.getElementById('morningReminder').value = morning;
            document.getElementById('eveningReminder').value = evening;
        }

        function saveReminders() {
            const morning = document.getElementById('morningReminder').value;
            const evening = document.getElementById('eveningReminder').value;
            
            localStorage.setItem('miniplan_morning_reminder', morning);
            localStorage.setItem('miniplan_evening_reminder', evening);
            
            showNotification('Hatƒ±rlatƒ±cƒ±lar kaydedildi!');
        }

        // AI motivation
        function updateAIMotivation() {
            const motivations = [
                "Bug√ºn harika bir g√ºn! Hedeflerinize odaklanƒ±n ve ba≈üarƒ±ya ula≈üƒ±n!",
                "Her adƒ±m bir ba≈üarƒ±dƒ±r. K√º√ß√ºk hedeflerle b√ºy√ºk sonu√ßlar elde edin!",
                "Motivasyonunuzu koruyun, hedeflerinize ula≈üacaksƒ±nƒ±z!",
                "Bug√ºn d√ºnk√º sizden daha iyi olun!",
                "Ba≈üarƒ± yolculuƒüunuzda her g√ºn bir fƒ±rsattƒ±r!"
            ];
            
            const randomMotivation = motivations[Math.floor(Math.random() * motivations.length)];
            document.getElementById('aiMotivation').textContent = randomMotivation;
        }

        // Utility functions
        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function isSameDay(date1, date2) {
            return formatDate(date1) === formatDate(date2);
        }

        function showNotification(message) {
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('MiniPlan', { body: message });
            } else {
                alert(message);
            }
        }

        // Auto-save goals when input changes
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('goal-input')) {
                setTimeout(saveGoals, 500);
            }
        });

        // Update AI motivation every hour
        setInterval(updateAIMotivation, 3600000);
        updateAIMotivation();
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('Service Worker registered successfully:', registration);
                    })
                    .catch(function(error) {
                        console.log('Service Worker registration failed:', error);
                    });
            });
        }
    </script>
</body>
</html>
